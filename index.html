<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Playable Ads</title>
  <style>
    @font-face{
      font-family: 'FrizQuadrataC';
      src: url('./fonts/FrizQuadrataC.otf');
    }

    @font-face {
      font-family: 'AlbertusMedium';
      src: url('./fonts/AlbertusMedium.ttf');
    }

    * {
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
<canvas id="game-window" width="1920"  height="1000">
</canvas>
<script>
  const cvs = document.getElementById('game-window');
  const ctx = cvs.getContext('2d');
  let requestAnimation;
  const bg = new Image();
  const tutorial = new Image();
  const gui = new Image();
  const glassBird = new Image();
  const playingCard = new Image();
  const purse = new Image();
  const apple = new Image();
  bg.src = 'img/bg_ho.png';
  tutorial.src = 'img/tutorial.png';
  glassBird.src = 'img/glass_bird.png';
  playingCard.src = 'img/playing_card.png';
  purse.src = 'img/purse.png';
  apple.src = 'img/apple.png';
  gui.src = 'img/ho_gui.png';

  tutorialObj = {
    x : cvs.width / 2 - 300,
    y : 35,
    w : 600,
    h : 250,
    textX : cvs.width / 2 - 130,
    textY : 170,
    line1 : 'Find all the'.toUpperCase(),
    line2 : 'hidden objects!'.toUpperCase(),
    size : 0,
    state : false,
    drawText : () => {
      ctx.fillText(tutorialObj.line1, tutorialObj.textX, tutorialObj.textY - tutorialObj.size / 2);
      ctx.fillText(tutorialObj.line2, tutorialObj.textX - 30, tutorialObj.textY + 40 + tutorialObj.size / 2);
    },
  };

  let playingCardObj = {
    x : cvs.width - 350,
    y : cvs.height / 2 + 100,
    w : 70,
    h : 100,
    size : 30,
    text : 'Playing card',
    textX : 500,
    textY : 940,
    globalA : 1,
  };

  let purseObj = {
    x : cvs.width / 4 + 50,
    y : cvs.height / 2 + 130,
    w : 120,
    h : 90,
    size : 30,
    text : 'Purse',
    textX : 830,
    textY : 940,
    globalA : 1,
  };

  let glassBirdObj = {
    x : cvs.width / 4 + 20,
    y : cvs.height / 4 -2,
    w : 100,
    h : 100,
    size : 30,
    text : 'Glass Bird',
    textX : 1050,
    textY : 940,
    globalA : 1,
  };

  let appleObj = {
    x : 1150,
    y : 550,
    w : 40,
    h : 40,
    size : 30,
    text : 'Apple',
    textX : 1350,
    textY : 940,
    globalA : 1,
  };

  let arr = [[playingCard, playingCardObj], [purse, purseObj], [glassBird, glassBirdObj], [apple, appleObj]];

  cvs.addEventListener('click', function(event) {
    let rect = cvs.getBoundingClientRect();
    let x = event.clientX - rect.left;
    let y = event.clientY - rect.top;
    arr.forEach((elem, i) => {
      if (elem[1].x <= x && x <= elem[1].x + elem[1].w && elem[1].y <= y && y <= elem[1].y + elem[1].h) {
       let int = setInterval(function() {
          if (elem[1].globalA > 0.1) {
            elem[1].w++;
            elem[1].h += 1 * elem[1].h / elem[1].h;
            elem[1].globalA -= 0.1;
            elem[1].size -= elem[1].globalA / elem[1].size;
          }
          else {
            delete arr[i];
            clearInterval(int);
          }
        }, 50)
      }
    });
    console.log(x, y);
  }, false);

  function draw() {
    ctx.globalAlpha = 1;
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    ctx.drawImage(bg, 0, 0);
    ctx.drawImage(tutorial, tutorialObj.x, tutorialObj.y, tutorialObj.w, tutorialObj.h);
    ctx.drawImage(gui, cvs.width / 6 + 20, cvs.height - 200, 1250, 200);

    arr.forEach((elem) => {
      ctx.globalAlpha = elem[1].globalA;
      console.log(elem[1].globalA);
      ctx.drawImage(elem[0], elem[1].x, elem[1].y, elem[1].w, elem[1].h);
      ctx.font = `${elem[1].size}px AlbertusMedium`;
      ctx.fillText(elem[1].text, elem[1].textX, elem[1].textY);
    });

    (function drawTutorial() {
      ctx.fillStyle = '#460000';
      ctx.font = `bold ${40 + tutorialObj.size}px FrizQuadrataC`;

      if (tutorialObj.size.toFixed(2) == 0 && tutorialObj.state === false) {
        tutorialObj.state = true;
      } else if (tutorialObj.size.toFixed(2) == 5 && tutorialObj.state === true) {
        tutorialObj.state = false;
      }
      if (tutorialObj.state === true) {
        tutorialObj.drawText();
        tutorialObj.size += 0.05;
        tutorialObj.textX -= tutorialObj.size / 15;
      } else {
        tutorialObj.drawText();
        tutorialObj.size -= 0.05;
        tutorialObj.textX += tutorialObj.size / 15;
        }
    })();
    requestAnimation = requestAnimationFrame(draw);
  }
  apple.onload = requestAnimationFrame(draw);
</script>
</body>
</html>