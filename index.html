<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Playable Ads</title>
  <style>
    @font-face{
      font-family: 'FrizQuadrataC';
      src: url('./fonts/FrizQuadrataC.otf');
    }

    @font-face {
      font-family: 'AlbertusMedium';
      src: url('./fonts/AlbertusMedium.ttf');
    }

    * {
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
<canvas id="game-window" width="1920"  height="1005">
</canvas>
<script>

  const cvs = document.getElementById('game-window');
  const ctx = cvs.getContext('2d');
  let requestAnimation;
  const bg = new Image();
  const bgCover = new Image();
  const bgBlur = new Image();
  const tutorial = new Image();
  const gui = new Image();
  const logo = new Image();
  const button = new Image();
  const glassBird = new Image();
  const playingCard = new Image();
  const purse = new Image();
  const apple = new Image();
  const mirror = new Image();
  const balerina = new Image();
  const parfume = new Image();
  const comb = new Image();

  bg.src = 'img/bg_ho.png';
  bgCover.src = 'img/bg_cover.png';
  bgBlur.src = 'img/bg_blur.png';

  tutorial.src = 'img/tutorial.png';
  glassBird.src = 'img/glass_bird.png';
  playingCard.src = 'img/playing_card.png';
  purse.src = 'img/purse.png';
  apple.src = 'img/apple.png';
  gui.src = 'img/ho_gui.png';
  logo.src = 'img/logo.png';
  button.src = 'img/button.png';
  mirror.src = 'img/mirror.png';
  balerina.src = 'img/balerina.png';
  parfume.src = 'img/parfume.png';
  comb.src = 'img/comb.png';

  //Данные объектов
  tutorialObj = {
    x : cvs.width / 2 - 295,
    y : 35,
    w : 600,
    h : 250,
    textX : cvs.width / 2 - 120,
    textY : 170,
    line1 : 'Find all the'.toUpperCase(),
    line2 : 'hidden objects!'.toUpperCase(),
    size : 0,
    state : false,
    drawText : () => {
      ctx.fillText(tutorialObj.line1, tutorialObj.textX, tutorialObj.textY - tutorialObj.size / 2);
      ctx.fillText(tutorialObj.line2, tutorialObj.textX - 40, tutorialObj.textY + 40 + tutorialObj.size / 2);
    },
  };

  let buttonObj = {
    x : cvs.width / 2 - 400 / 2,
    y : 400,
    w : 400,
    h : 100,
    text: 'Play Free',
  };

  let logoObj = {
    x : cvs.width / 2 - 800 / 2,
    y : 0,
    w : 800,
    h : 400,
  };

  class imageObj {
    constructor(x, y, w, h, text, textX, textY, angle = 0) {
      this.x = x;
      this.y = y;
      this.w = w;
      this.h = h;
      this.text = text;
      this.textX = textX;
      this.textY = textY;
      this.angle = angle;
      this.globalA = 1;
      this.backlight = false;
    }
  }

  //first set
  let playingCardObj = new imageObj(cvs.width - 390, cvs.height / 2 + 60, 70, 100, 'Playing card', 500, 940, -45);
  let purseObj = new imageObj(cvs.width / 4 + 50, cvs.height / 2 + 150, 100, 90, 'Purse', 830, 940, 10);
  let glassBirdObj = new imageObj(cvs.width / 4 + 20, cvs.height / 4 - 2, 100, 100, 'Glass Bird', 1050, 940);
  let appleObj = new imageObj(1150, 550, 70, 70, 'Apple', 1350, 940);

  //second set
  let mirrorObj = new imageObj(360, 350, 100, 150, 'Mirror', 500, 940);
  let balerinaObj = new imageObj(1010, 430, 100, 200, 'Ballet Dancer', 750, 940);
  let parfumeObj = new imageObj(cvs.width / 4 + 60, cvs.height / 2 + 180, 70, 80, 'Parfume', 1090, 940, 25);
  let combObj = new imageObj(cvs.width - 260, cvs.height / 2 + 10, 50, 80, 'Comb', 1350, 940, 25);

  const randomNum = Math.round(Math.random());

  let objArr1 = [[playingCard, playingCardObj], [purse, purseObj], [glassBird, glassBirdObj], [apple, appleObj]];
  let objArr2 = [[mirror, mirrorObj], [balerina, balerinaObj], [parfume, parfumeObj], [comb, combObj]];

  let arr = [objArr1, objArr2][randomNum];

  function inRad(num) {
    return num * Math.PI / 180;
  }

  //Начальное время
  let time = performance.now();

  //Обработка объектов
  cvs.addEventListener('click', function(event) {
    let rect = cvs.getBoundingClientRect();
    let x = event.clientX - rect.left;
    let y = event.clientY - rect.top;
    arr.forEach((elem, i) => {
      if (elem[1].x <= x && x <= elem[1].x + elem[1].w && elem[1].y <= y && y <= elem[1].y + elem[1].h) {
        time = performance.now();
       let int = setInterval(function() {
          if (elem[1].globalA > 0.1) {
            elem[1].w++;
            elem[1].h += 1 * elem[1].h / elem[1].h;
            elem[1].globalA -= 0.1;
          }
          else {
            delete arr[i];
            arr = arr.filter((elem) => {
              return elem;
            });
            clearInterval(int);
          }
        }, 50);
      }
    });
  }, false);

  //Главная функция отрисовки
  function draw() {
    ctx.globalAlpha = 1;
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    ctx.drawImage(bg, 0, 0);
    ctx.drawImage(gui, cvs.width / 6 + 20, cvs.height - 200, 1250, 200);

    //Отрисовка объектов
    arr.forEach((elem) => {
      ctx.globalAlpha = elem[1].globalA;

      //Проверка на время
      if (performance.now() - time >= 5 * 1000 && arr[0][1].backlight === false) {
        arr[0][1].backlight = true;
        let count = 0;
        let state = false;

        //Запуск анимации для первого объекта в списке
        let inter = setInterval(() => {
          if(count == 0 && state === false) {
            state = true;
          } else if (count == 30 && state === true) {
            state = false;
          }

          if (state) {
            arr[0][1].w += 0.5;
            arr[0][1].h += 0.5;
            count++
          } else {
            arr[0][1].w -= 0.5;
            arr[0][1].h -= 0.5;
            count--;
          }

          //Отключение анимации при клике на объект
          cvs.addEventListener('click', function(event) {
            let rect = cvs.getBoundingClientRect();
            let x = event.clientX - rect.left;
            let y = event.clientY - rect.top;
            arr.forEach((elem, i) => {
              if (elem[1].x <= x && x <= elem[1].x + elem[1].w && elem[1].y <= y && y <= elem[1].y + elem[1].h) {
                clearInterval(inter);
              }
            });
          });
        }, 50);
      }
      if(elem[1].angle) {
        ctx.save();
        ctx.translate(elem[1].x + elem[1].h / 2, elem[1].y + elem[1].w / 2);
        ctx.rotate(inRad(elem[1].angle));
        ctx.drawImage(elem[0], -elem[1].w / 2, -elem[1].h / 2, elem[1].w, elem[1].h);
        ctx.restore();
      } else {
        ctx.drawImage(elem[0], elem[1].x, elem[1].y, elem[1].w, elem[1].h);
      }
      ctx.font = `30px AlbertusMedium`;
      ctx.fillText(elem[1].text, elem[1].textX, elem[1].textY);
      ctx.drawImage(bgCover, 0, 0);
    });

    //Отрисовка tutorial
    if (arr.length !== 0) {
      ctx.drawImage(tutorial, tutorialObj.x, tutorialObj.y, tutorialObj.w, tutorialObj.h);
      (function drawTutorial() {
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#460000';
        ctx.font = `bold ${40 + tutorialObj.size}px FrizQuadrataC`;

        if (tutorialObj.size.toFixed(2) == 0 && tutorialObj.state === false) {
          tutorialObj.state = true;
        } else if (tutorialObj.size.toFixed(2) == 5 && tutorialObj.state === true) {
          tutorialObj.state = false;
        }
        if (tutorialObj.state === true) {
          tutorialObj.drawText();
          tutorialObj.size += 0.05;
          tutorialObj.textX -= tutorialObj.size / 15;
        } else {
          tutorialObj.drawText();
          tutorialObj.size -= 0.05;
          tutorialObj.textX += tutorialObj.size / 15;
        }
      })();
    }
    else {
      ctx.drawImage(bgBlur, 0, 0);
      ctx.drawImage(logo, logoObj.x, logoObj.y, logoObj.w, logoObj.h);
      ctx.drawImage(button, buttonObj.x, buttonObj.y, buttonObj.w, buttonObj.h);
      ctx.fillText(buttonObj.text, buttonObj.x + 120, buttonObj.y + 60);
    }
    requestAnimation = requestAnimationFrame(draw);
  }
  gui.onload = requestAnimationFrame(draw);
</script>
</body>
</html>