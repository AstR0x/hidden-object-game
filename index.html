<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Playable Ads</title>
  <style>
    @font-face{
      font-family: 'FrizQuadrataC';
      src: url('./fonts/FrizQuadrataC.otf');
    }

    @font-face {
      font-family: 'AlbertusMedium';
      src: url('./fonts/AlbertusMedium.ttf');
    }

    * {
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
<canvas id="game-window" width="1920"  height="1080">
</canvas>
<script>
  const cvs = document.getElementById('game-window');
  const ctx = cvs.getContext('2d');
  let requestAnimation;

  class Img {
    constructor(src, x, y, w, h) {
      this.img = new Image();
      this.img.src = src;
      this.x = x;
      this.y = y;
      this.w = w;
      this.h = h;
      this.globalA = 0;
    }

    slowDraw() {
      ctx.globalAlpha = this.globalA;
      if(this.globalA < 1) this.globalA += 0.05;
      if (this.w && this.h) {
        ctx.drawImage(this.img, this.x, this.y, this.w, this.h);
      } else {
        ctx.drawImage(this.img, this.x, this.y);
      }
    }

    drawImg() {
      ctx.globalAlpha = 1;
      if (this.w && this.h) {
        ctx.drawImage(this.img, this.x, this.y, this.w, this.h);
      } else {
        ctx.drawImage(this.img, this.x, this.y);
      }
    }
  }

  class ImgOfObject extends Img {
    constructor(src, x, y, w, h, text, textX, textY, angle = 0) {
     super(src, x, y, w, h, text);
      this.text = text;
      this.textX = textX;
      this.textY = textY;
      this.angle = angle;
      this.globalA = 1;
      this.backlight = false;
      this.animateState = false;
      this.count = 0;
    }

     drawImg() {
       ctx.drawImage(this.img, this.x, this.y, this.w, this.h);
     }

     drawAngleImg() {
       ctx.save();
       ctx.translate(this.x + this.h / 2, this.y + this.w / 2);
       ctx.rotate(inRad(this.angle));
       ctx.drawImage(this.img, -this.w / 2, -this.h / 2, this.w, this.h);
       ctx.restore();
     }

     drawText() {
       ctx.font = '30px AlbertusMedium';
       ctx.fillText(this.text, this.textX, this.textY);
     }

     animate() {
       if(this.count == 0 && this.animateState === false) {
         this.animateState = true;
       } else if (this.count == 30 && this.animateState === true) {
         this.animateState = false;
       }

       if (this.animateState) {
         this.w += 0.5;
         this.h += 0.5;
         this.count++
       } else {
         this.w -= 0.5;
         this.h -= 0.5;
         this.count--;
       }
     }
  }

  class AnimateImg extends ImgOfObject {
    constructor(src, x, y, w, h, text, textX, textY, angle = 0) {
      super(src, x, y, w, h, text, textX, textY, angle = 0);
      this.animateState = false;
      this.size = 0;
    }

    animate() {
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#460000';
        ctx.font = `bold ${40 + this.size}px FrizQuadrataC`;
        if (this.size.toFixed(2) == 0 && this.animateState === false) {
          this.animateState = true;
        } else if (this.size.toFixed(2) == 5 && this.animateState === true) {
          this.animateState = false;
        }
        if (this.animateState === true) {
          this.drawText();
          this.size += 0.1;
          this.textX -= this.size / 100;
        } else {
          this.drawText();
          this.size -= 0.1;
          this.textX += this.size / 100;
        }
      }
  }

  let bg = new Img('img/bg_ho.png', 0, 0);
  let bgCover = new Img('img/bg_cover.png', 0, 0);
  let bgBlur = new Img('img/bg_blur.png', 0, 0);

  let gui = new Img('img/ho_gui.png', cvs.width / 6 + 20, cvs.height - 200, 1250, 200);
  let logo = new Img('img/logo.png', cvs.width / 2 - 800 / 2, 200, 800, 400);
    
  const tutorial = new AnimateImg('img/tutorial.png', cvs.width / 2 - 295, 35, 600, 250, 'Find all the\nhidden objects',
  cvs.width / 2 - 120, 170);

  tutorial.drawText = function() {
    ctx.fillText('Find all the'.toUpperCase(), this.textX, this.textY - this.size / 2);
    ctx.fillText('hidden objects!'.toUpperCase(), this.textX - 40, this.textY + 40 + this.size / 2);
  }


  let button = new AnimateImg('img/button.png', cvs.width / 2 - 400 / 2, 600, 400, 100, 'Play FREE', 900, 660);


  //first set
  let playingCardObj = new ImgOfObject('img/playing_card.png', cvs.width - 390, cvs.height / 2 + 60, 70, 100,
    'Playing card', 500, 1020, -45);
  let purseObj = new ImgOfObject('img/purse.png', cvs.width / 4 + 50, cvs.height / 2 + 125, 100, 90, 'Purse', 830,
    1020, 10);
  let glassBirdObj = new ImgOfObject('img/glass_bird.png', cvs.width / 4 + 20, cvs.height / 4 - 2, 100, 100,
    'Glass Bird', 1050, 1020);
  let appleObj = new ImgOfObject('img/apple.png', 1150, 554, 60, 60, 'Apple', 1350, 1020);

  //second set
  let mirrorObj = new ImgOfObject('img/mirror.png', 360, 350, 100, 150, 'Mirror', 500, 1020);
  let balerinaObj = new ImgOfObject('img/balerina.png', 1010, 425, 100, 200, 'Ballet Dancer', 750, 1020);
  let parfumeObj = new ImgOfObject('img/parfume.png', cvs.width / 4 + 60, cvs.height / 2 + 145, 70, 80, 'Parfume', 1090, 1020, 25);
  let combObj = new ImgOfObject('img/comb.png', cvs.width - 260, cvs.height / 2 - 40, 50, 80, 'Comb', 1350, 1020, 25);

  //third set
  let bookObj = new ImgOfObject('img/book.png', 1270, 600, 120, 120, 'Book', 500, 1020, -10);
  let basketObj = new ImgOfObject('img/basket.png', 940, 500, 130, 130, 'Basket', 770, 1020);
  let fanObj = new ImgOfObject('img/fan.png', 640, cvs.height / 2, 150, 75, 'Fan', 1090, 1020, -150);
  let shoeObj = new ImgOfObject('img/shoe.png', 1050, 830, 100, 100, 'Shoe', 1350, 1020);

  const randomNum = Math.round(Math.random() * 2);

  let arrOfArrays = [[playingCardObj, purseObj, glassBirdObj, appleObj],
     [mirrorObj, balerinaObj, parfumeObj, combObj], [bookObj,
       basketObj, fanObj, shoeObj]];

  let arrOfObjects = arrOfArrays[randomNum];

  //Функция для перевода градусов в радианы
  function inRad(num) {
    return num * Math.PI / 180;
  }

  //Начальное время
  let time = performance.now();

  //Обработка объектов
  cvs.addEventListener('click', function(event) {
    let rect = cvs.getBoundingClientRect();
    let x = event.clientX - rect.left;
    let y = event.clientY - rect.top;
    arrOfObjects.forEach((elem, i) => {
      if (elem.x <= x && x <= elem.x + elem.w && elem.y <= y && y <= elem.y + elem.h) {
        time = performance.now();
       let int = setInterval(function() {
          if (elem.globalA > 0.1) {
            elem.w++;
            elem.h += 1 * elem.h / elem.h;
            elem.globalA -= 0.1;
          }
          else {
            delete arrOfObjects[i];
            arrOfObjects = arrOfObjects.filter((elem) => {
              return elem;
            });
            clearInterval(int);
          }
        }, 50);
      }
    });
  }, false);

  //Главная функция отрисовки
  function draw() {
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    bg.drawImg();
    gui.drawImg();

    //Отрисовка объектов
    arrOfObjects.forEach((elem) => {
       ctx.globalAlpha = elem.globalA;

      //Проверка на время
      if (performance.now() - time >= 5 * 1000 && arrOfObjects[0].backlight === false) {
        arrOfObjects[0].backlight = true;

        //Запуск анимации для первого объекта в списке
        let inter = setInterval(() => {
          arrOfObjects[0].animate();

          //Отключение анимации при клике на объект
          cvs.addEventListener('click', function(event) {
            let rect = cvs.getBoundingClientRect();
            let x = event.clientX - rect.left;
            let y = event.clientY - rect.top;
            arrOfObjects.forEach((elem) => {
              if (elem.x <= x && x <= elem.x + elem.w && elem.y <= y && y <= elem.y + elem.h) {
                clearInterval(inter);
              }
            });
          });
        }, 50);
      }
      if(elem.angle) {
        elem.drawAngleImg();
      } else {
        elem.drawImg();
      }
      elem.drawText();
      bgCover.drawImg();
    });

    //Отрисовка tutorial
    if (arrOfObjects.length !== 0) {
      tutorial.drawImg();
      tutorial.animate();
    }
    else {
      bgBlur.slowDraw();
      logo.drawImg();
      button.drawImg();
      button.drawText();
      setInterval(button.animate(), 50);
    }
    requestAnimation = requestAnimationFrame(draw);
  }
  gui.onload = requestAnimationFrame(draw);
</script>
</body>
</html>