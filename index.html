<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Playable Ads</title>
  <style>
    @font-face{
      font-family: 'FrizQuadrataC';
      src: url('./fonts/FrizQuadrataC.otf');
    }

    @font-face {
      font-family: 'AlbertusMedium';
      src: url('./fonts/AlbertusMedium.ttf');
    }

    * {
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
<canvas id="game-window" width="1920"  height="1005">
</canvas>
<script>

  const cvs = document.getElementById('game-window');
  const ctx = cvs.getContext('2d');
  let requestAnimation;
  const bg = new Image();
  const tutorial = new Image();
  const gui = new Image();
  const logo = new Image();
  const button = new Image();
  const glassBird = new Image();
  const playingCard = new Image();
  const purse = new Image();
  const apple = new Image();

  bg.src = 'img/bg_ho.png';
  tutorial.src = 'img/tutorial.png';
  glassBird.src = 'img/glass_bird.png';
  playingCard.src = 'img/playing_card.png';
  purse.src = 'img/purse.png';
  apple.src = 'img/apple.png';
  gui.src = 'img/ho_gui.png';
  logo.src = 'img/logo.png';
  button.src = 'img/button.png';

  //Данные объектов
  tutorialObj = {
    x : cvs.width / 2 - 295,
    y : 35,
    w : 600,
    h : 250,
    textX : cvs.width / 2 - 120,
    textY : 170,
    line1 : 'Find all the'.toUpperCase(),
    line2 : 'hidden objects!'.toUpperCase(),
    size : 0,
    state : false,
    drawText : () => {
      ctx.fillText(tutorialObj.line1, tutorialObj.textX, tutorialObj.textY - tutorialObj.size / 2);
      ctx.fillText(tutorialObj.line2, tutorialObj.textX - 40, tutorialObj.textY + 40 + tutorialObj.size / 2);
    },
  };

  let buttonObj = {
    x : cvs.width / 2 - 400 / 2,
    y : 400,
    w : 400,
    h : 100,
    text: 'Play Free',
  };

  let logoObj = {
    x : cvs.width / 2 - 800 / 2,
    y : 0,
    w : 800,
    h : 400,
  };

  let playingCardObj = {
    x : cvs.width - 350,
    y : cvs.height / 2 + 100,
    w : 70,
    h : 100,
    size : 30,
    text : 'Playing card',
    textX : 500,
    textY : 940,
    globalA : 1,
    backlight : false,
  };

  let purseObj = {
    x : cvs.width / 4 + 50,
    y : cvs.height / 2 + 130,
    w : 120,
    h : 90,
    size : 30,
    text : 'Purse',
    textX : 830,
    textY : 940,
    globalA : 1,
    backlight : false,
  };

  let glassBirdObj = {
    x : cvs.width / 4 + 20,
    y : cvs.height / 4 -2,
    w : 100,
    h : 100,
    size : 30,
    text : 'Glass Bird',
    textX : 1050,
    textY : 940,
    globalA : 1,
    backlight : false,
  };

  let appleObj = {
    x : 1150,
    y : 550,
    w : 40,
    h : 40,
    size : 30,
    text : 'Apple',
    textX : 1350,
    textY : 940,
    globalA : 1,
    backlight : false,
  };

  let arr = [[playingCard, playingCardObj], [purse, purseObj], [glassBird, glassBirdObj], [apple, appleObj]];

  //Начальное время
  let time = performance.now();

  //Обработка объектов
  cvs.addEventListener('click', function(event) {
    let rect = cvs.getBoundingClientRect();
    let x = event.clientX - rect.left;
    let y = event.clientY - rect.top;
    arr.forEach((elem, i) => {
      if (elem[1].x <= x && x <= elem[1].x + elem[1].w && elem[1].y <= y && y <= elem[1].y + elem[1].h) {
        time = performance.now();
       let int = setInterval(function() {
          if (elem[1].globalA > 0.1) {
            elem[1].w++;
            elem[1].h += 1 * elem[1].h / elem[1].h;
            elem[1].globalA -= 0.1;
            elem[1].size -= elem[1].globalA / elem[1].size;
          }
          else {
            delete arr[i];
            arr = arr.filter((elem) => {
              return elem;
            });
            clearInterval(int);
          }
        }, 50);
      }
    });
  }, false);

  //Главная функция отрисовки
  function draw() {
    ctx.globalAlpha = 1;
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    ctx.drawImage(bg, 0, 0);

    ctx.drawImage(gui, cvs.width / 6 + 20, cvs.height - 200, 1250, 200);

    //Отрисовка объектов
    arr.forEach((elem) => {
      ctx.globalAlpha = elem[1].globalA;

      //Проверка на время
      if (performance.now() - time >= 5 * 1000 && arr[0][1].backlight === false) {
        arr[0][1].backlight = true;
        let count = 0;
        let state = false;

        //Запуск анимации для первого объекта в списке
        let inter = setInterval(() => {
          if(count == 0 && state === false) {
            state = true;
          } else if (count == 30 && state === true) {
            state = false;
          }

          if (state) {
            arr[0][1].w += 0.5;
            arr[0][1].h += 0.5;
            count++
          } else {
            arr[0][1].w -= 0.5;
            arr[0][1].h -= 0.5;
            count--;
          }

          //Отключение анимации при клике на объект
          cvs.addEventListener('click', function(event) {
            let rect = cvs.getBoundingClientRect();
            let x = event.clientX - rect.left;
            let y = event.clientY - rect.top;
            arr.forEach((elem, i) => {
              if (elem[1].x <= x && x <= elem[1].x + elem[1].w && elem[1].y <= y && y <= elem[1].y + elem[1].h) {
                clearInterval(inter);
              }
            });
          });
        }, 50);
      }
      ctx.drawImage(elem[0], elem[1].x, elem[1].y, elem[1].w, elem[1].h);
      ctx.font = `${elem[1].size}px AlbertusMedium`;
      ctx.fillText(elem[1].text, elem[1].textX, elem[1].textY);
    });

    //Отрисовка tutorial
    if (arr.length !== 0) {
      ctx.drawImage(tutorial, tutorialObj.x, tutorialObj.y, tutorialObj.w, tutorialObj.h);
      (function drawTutorial() {
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#460000';
        ctx.font = `bold ${40 + tutorialObj.size}px FrizQuadrataC`;

        if (tutorialObj.size.toFixed(2) == 0 && tutorialObj.state === false) {
          tutorialObj.state = true;
        } else if (tutorialObj.size.toFixed(2) == 5 && tutorialObj.state === true) {
          tutorialObj.state = false;
        }
        if (tutorialObj.state === true) {
          tutorialObj.drawText();
          tutorialObj.size += 0.05;
          tutorialObj.textX -= tutorialObj.size / 15;
        } else {
          tutorialObj.drawText();
          tutorialObj.size -= 0.05;
          tutorialObj.textX += tutorialObj.size / 15;
        }
      })();
    }
    else {
      ctx.drawImage(logo, logoObj.x, logoObj.y, logoObj.w, logoObj.h);
      ctx.drawImage(button, buttonObj.x, buttonObj.y, buttonObj.w, buttonObj.h);
      //ctx.fillstyle = '#ffffff';
      ctx.fillText(buttonObj.text, buttonObj.x + 120, buttonObj.y + 60);
    }
    requestAnimation = requestAnimationFrame(draw);
  }
  gui.onload = requestAnimationFrame(draw);
</script>
</body>
</html>